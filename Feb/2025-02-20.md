# TIL Template

## ë‚ ì§œ: 2025-02-20

### ìŠ¤í¬ëŸ¼
- í•™ìŠµ ëª©í‘œ 1 : ì•„ì¹¨ ìŠ¤í¬ëŸ¼ì— ì‘ì„±í•œ ë‚´ìš© ë¶™ì—¬ë„£ê¸°
- í•™ìŠµ ëª©í‘œ 2
- í•™ìŠµ ëª©í‘œ 3

## FastAPI
- API Server</br>
    - ì„œë²„ì˜ ê¸°ëŠ¥ì„ ì™¸ë¶€ì—ì„œ ì“¸ ìˆ˜ ìˆë„ë¡ ë…¸ì¶œí•œë‹¤.
    - JSON ë©”ì‹œì§€ í˜•ì‹ìœ¼ë¡œ ì‘ë‹µí•œë‹¤.
    - REST : APIë¥¼ ë§Œë“œëŠ” ìŠ¤íƒ€ì¼
    - ì¡°íšŒ : í´ë¼ì´ì–¸íŠ¸(ë¸Œë¼ìš°ì €)ê°€ GET ìš”ì²­ì„ í•œë‹¤.
    - ìƒì„± : í´ë¼ì´ì–¸íŠ¸(ë¸Œë¼ìš°ì €)ê°€ POST ìš”ì²­ì„ í•œë‹¤.

- FastAPI ì„¤ì¹˜
    ```bash
    $ pip install "fastapi[standard]"
    ```
- FastAPI ì‚¬ìš©í•´ë³´ê¸°
    1. `main.py` ìƒì„±
        ```python
        from typing import Union

        from fastapi import FastAPI

        app = FastAPI()


        @app.get("/")
        def read_root():
            return {"Hello": "World"}


        @app.get("/items/{item_id}")
        def read_item(item_id: int, q: Union[str, None] = None):
            return {"item_id": item_id, "q": q}
        ```
    2. fastapi ì‹¤í–‰
        ```bash
        $ fastapi dev main.py

                FastAPI   Starting development server ğŸš€

                    Searching for package file structure from directories with __init__.py files
                    Importing from \\...
        
            module   ğŸ main.py

            code   Importing the FastAPI app object from the module with the following code:

                    from main import app

            app   Using import string: main:app

            server   Server started at http://127.0.0.1:8000
            server   Documentation at http://127.0.0.1:8000/docs

            tip   Running in development mode, for production use: fastapi run

                    Logs:

            INFO   Will watch for changes in these directories: []
            INFO   Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
            INFO   Started reloader process [37788] using WatchFiles
            INFO   Started server process [6124]
            INFO   Waiting for application startup.
            INFO   Application startup complete.
        ```

- FastAPIë¡œ AI ëª¨ë¸ ë„£ê¸°
    1. `model.py` ìƒì„±</br>
        í•´ë‹¹ AI ëª¨ë¸ ì˜ˆì‹œëŠ” AND ë¶„ë¥˜ê¸° ì´ë‹¤.
        ```python
        import numpy as np

        class AndModel:
            def __init__(self):
                # íŒŒë¼ë©”í„°
                self.weights = np.random.rand(2)
                self.bias = np.random.rand(1)

            def train(self):
                learning_rate = 0.1
                epochs = 20
                inputs = np.array([[0, 0], [0, 1], [1, 0], [1, 1]])
                outputs = np.array([0, 0, 0, 1])        
                for epoch in range(epochs):
                    for i in range(len(inputs)):
                        # ì´ ì…ë ¥ ê³„ì‚°
                        total_input = np.dot(inputs[i], self.weights) + self.bias
                        # ì˜ˆì¸¡ ì¶œë ¥ ê³„ì‚°
                        prediction = self.step_function(total_input)
                        # ì˜¤ì°¨ ê³„ì‚°
                        error = outputs[i] - prediction
                        print(f'inputs[i] : {inputs[i]}')
                        print(f'weights : {self.weights}')
                        print(f'bias before update: {self.bias}')
                        print(f'prediction: {prediction}')
                        print(f'error: {error}')
                        # ê°€ì¤‘ì¹˜ì™€ í¸í–¥ ì—…ë°ì´íŠ¸
                        self.weights += learning_rate * error * inputs[i]
                        self.bias += learning_rate * error
                        print('====')        

            def step_function(self, x):
                return 1 if x >= 0 else 0
            
            def predict(self, input_data):
                total_input = np.dot(input_data, self.weights) + self.bias
                return self.step_function(total_input) 
        ```
    2. `main.py` ì—ì„œ model importí•˜ê¸°</br>
        ```python
        import model

        model = model.AndModel()
        ```
        í•´ë‹¹ ì½”ë“œë¥¼ ì´ìš©í•´ `model.py`ë¥¼ `main.py`ì— import í•˜ì—¬ `model.AndModel`ì˜ í´ë˜ìŠ¤ë¥¼ ê°€ì§€ê³  ì˜¬ ìˆ˜ ìˆë‹¤.

    3. `main.py`ì—ì„œ train êµ¬í˜„í•˜ê¸°
        ```python
        @app.get("/train")
        def train():
            model.train()
            return {"result": "OK"}
        ```
        `@app.get("/train")`ì„ ì´ìš©í•´ `./train`ì—ì„œ `model.train`ì„ êµ¬í˜„í•˜ë„ë¡ í•œë‹¤.</br>

        ![alt text](/Feb/image/fastapi_train.png)</br>

        `main.py` í„°ë¯¸ë„ ì¶œë ¥</br>
        ```
        ...

        inputs[i] : [0 0]
        weights : [0.16793551 0.24359895]
        bias before update: [-0.36225755]
        prediction: 0
        error: 0
        ====

        ...

         INFO   127.0.0.1:53554 - "GET /train HTTP/1.1" 200
        ```
        


    4. `main.py`ì—ì„œ predict êµ¬í˜„í•˜ê¸°
        ```python
        @app.get("/predict/left/{left}/right/{right}") 
        def predict(left: int, right: int):
            result = model.predict([left, right])
            return {"result": result}
        ```
        `./predict/`ì—ì„œ `/left/{left}`ë¡œ left ì¸ìì™€ `/right/{right}`ë¡œ right ì¸ìë¥¼ ë¶ˆëŸ¬ì™€ `model.predict`ì— ì¸ìë¡œ ë„£ì–´ êµ¬í˜„í•˜ë„ë¡ í•œë‹¤.

        |ì…ë ¥ 1|ì…ë ¥ 2|ê²°ê³¼|
        |--|--|--|
        |0|0|![alt text](/Feb/image/fastapi_result00.png)|
        |0|1|![alt text](/Feb/image/fastapi_result01.png)|
        |1|0|![alt text](/Feb/image/fastapi_result10.png)|
        |1|1|![alt text](/Feb/image/fastapi_result11.png)|

        `main.py` í„°ë¯¸ë„ ì¶œë ¥</br>
        ```
         INFO   127.0.0.1:53627 - "GET /predict/left/0/right/0 HTTP/1.1" 200
         INFO   127.0.0.1:53640 - "GET /predict/left/0/right/1 HTTP/1.1" 200
         INFO   127.0.0.1:53651 - "GET /predict/left/1/right/0 HTTP/1.1" 200
         INFO   127.0.0.1:53652 - "GET /predict/left/1/right/1 HTTP/1.1" 200
        ```


#### ì£¼ì œ 2: ì£¼ì œì— ëŒ€í•œ ì„¤ëª…
- ìƒì„¸ ë‚´ìš© 1
- ìƒì„¸ ë‚´ìš© 2

### ì˜¤ëŠ˜ì˜ ë„ì „ ê³¼ì œì™€ í•´ê²° ë°©ë²•
- ë„ì „ ê³¼ì œ 1: ë„ì „ ê³¼ì œì— ëŒ€í•œ ì„¤ëª… ë° í•´ê²° ë°©ë²•
- ë„ì „ ê³¼ì œ 2: ë„ì „ ê³¼ì œì— ëŒ€í•œ ì„¤ëª… ë° í•´ê²° ë°©ë²•

### ì˜¤ëŠ˜ì˜ íšŒê³ 
- ì˜¤ëŠ˜ì˜ í•™ìŠµ ê²½í—˜ì— ëŒ€í•œ ììœ ë¡œìš´ ìƒê°ì´ë‚˜ ëŠë‚€ ì ì„ ê¸°ë¡í•©ë‹ˆë‹¤.
- ì„±ê³µì ì¸ ì , ê°œì„ í•´ì•¼ í•  ì , ìƒˆë¡­ê²Œ ì‹œë„í•˜ê³  ì‹¶ì€ ë°©ë²• ë“±ì„ í¬í•¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ì°¸ê³  ìë£Œ ë° ë§í¬
- [ë§í¬ ì œëª©](URL)
- [ë§í¬ ì œëª©](URL)